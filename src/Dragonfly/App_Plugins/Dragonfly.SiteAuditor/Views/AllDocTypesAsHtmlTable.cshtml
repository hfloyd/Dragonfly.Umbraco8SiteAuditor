@using System.Web.Mvc.Html;
@using Dragonfly.SiteAuditor.Helpers;
@using Dragonfly.SiteAuditor.Models;
@using Umbraco.Web;

@model IEnumerable<AuditableDocType>
@{
    //TODO: Finish this

    var fancyFormat = true;
    IEnumerable<AuditableDocType> docTypes = Model.ToList();
    //var propertyAlias = Dragonfly.UmbracoHelpers.Mvc.GetSafeViewDataString(ViewData, "PropertyAlias");
    // var includeUnpublished = Dragonfly.UmbracoHelpers.Mvc.GetSafeViewDataBool(ViewData, "IncludeUnpublished");

    var counter = 0;
}

<!DOCTYPE html>
<html>
<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet" />

    @*<style>
            {

            }
        </style>*@
    @*<!--<script src="/scripts/snippet-javascript-console.min.js?v=1"></script>-->*@
</head>
<body>
    <div class="container">
        @if (fancyFormat)
        {
            <h1>All Document Types</h1>
            <p>Total Document Types Returned: @docTypes.Count()</p>
        }
        <table id="umbracodata" class="table table-striped table-bordered table-hover table-sm" cellspacing="0" style="width:100%">
            <thead>
                <tr>
                    @if (fancyFormat)
                    {
                        <th>#</th>
                        <th>Actions</th>
                    }
                    <th>Doctype Name</th>
                    <th>Alias</th>
                    <th>Default Template</th>
                    <th>Id</th>
                    <th>GUID</th>
                    <th>Create Date</th>
                    <th>Update Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var dt in docTypes)
                {
                    counter++;

                    <tr>
                        @if (fancyFormat)
                        {
                            // #
                            <td>@counter</td>

                            //Actions
                            <td>
                                @{ Html.RenderPartial("/App_Plugins/Dragonfly.SiteAuditor/Views/DataFormats/SchemaActions.cshtml", dt.Id, new ViewDataDictionary()
                                                 {
                                       {"EntityType", "DataType" }
                                   }); }
                            </td>
                        }

                        @*//Name*@
                        <td>@dt.Name</td>

                        @*//Path*@
                        <td>@dt.PathAsText</td>

                        @*//Property Editor Alias*@
                        <td>@dt.EditorAlias</td>

                        @*//Used On Properties*@
                        @if (dt.UsedOnProperties.Any())
                        {
                            <td>@Html.Raw(string.Join(" <br/> ", dt.UsedOnProperties.Select(n => $"{n.Value} [{n.Key.Alias}]")))</td>
                        }
                        else
                        {
                            <td>~NONE~</td>
                        }

                        @*//Qty of Properties*@
                        <td>@dt.UsedOnProperties.Count()</td>

                        @*// ID*@
                        <td>@dt.Id</td>

                        @*// GUID*@
                        <td>@dt.Guid.ToString()</td>
                    </tr>
                }

            </tbody>
        </table>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#umbracodata').DataTable();
            @*//$('#umbracodata').dataTable( {
            //    "columns": [
            //    { "width": "20%" },
            //    null,
            //    null,
            //    null,
            //    null
            //        ]
            //} );*@
        });
    </script>
</body>
</html>